- pipeline: "Build & Deploy"
  trigger_mode: "ON_EVERY_PUSH"
  ref_name: "develop"
  ref_type: "BRANCH"
  trigger_condition: "ALWAYS"
  actions:
  - action: "Execute: npm install"
    type: "BUILD"
    working_directory: "/buddy/sepa-customer-platform"
    docker_image_name: "library/node"
    docker_image_tag: "10"
    execute_commands:
    - "npm install"
    setup_commands:
    - "npm install -g gulp grunt-cli"
    mount_filesystem_path: "/buddy/sepa-customer-platform"
    shell: "BASH"
    trigger_condition: "ALWAYS"
  - action: "Execute: npm test"
    type: "BUILD"
    working_directory: "/buddy/sepa-customer-platform"
    docker_image_name: "library/node"
    docker_image_tag: "10"
    execute_commands:
    - "npm test"
    setup_commands:
    - "npm install -g gulp grunt-cli"
    mount_filesystem_path: "/buddy/sepa-customer-platform"
    shell: "BASH"
    trigger_condition: "ALWAYS"
  - action: "Rsync to 3.9.146.162"
    type: "RSYNC"
    local_path: "./"
    remote_path: "/home/ec2-user/home/deploy/app"
    login: "ec2-user"
    host: "3.9.173.89"
    port: "22"
    env_key: "secure!SNNDqTIeWLhftBF6b+29oQ=="
    authentication_mode: "ENV_KEY"
    archive: true
    delete_extra_files: true
    compress: true
    deployment_excludes:
    - "/.git/"
    trigger_condition: "ALWAYS"
  - action: "[3.9.173.89] Execute: docker-compose up -d --build"
    type: "SSH_COMMAND"
    working_directory: "/home/ec2-user/home/deploy/app/"
    login: "ec2-user"
    host: "3.9.173.89"
    port: "22"
    env_key: "secure!SNNDqTIeWLhftBF6b+29oQ=="
    authentication_mode: "ENV_KEY"
    commands:
    - "docker-compose down"
    - "docker-compose rm"
    - "docker system prune -af"
    - "docker-compose up -d -f docker-compose.prod.yml --build --force-recreate"
    run_as_script: true
    shell: "BASH"
    trigger_condition: "ALWAYS"
- pipeline: "Test Build"
  trigger_mode: "ON_EVERY_PUSH"
  ref_name: "*"
  ref_type: "WILDCARD"
  trigger_condition: "ALWAYS"
  actions:
  - action: "Execute: npm install"
    type: "BUILD"
    working_directory: "/buddy/sepa-customer-platform"
    docker_image_name: "library/node"
    docker_image_tag: "10"
    execute_commands:
    - "npm install"
    setup_commands:
    - "npm install -g gulp grunt-cli"
    mount_filesystem_path: "/buddy/sepa-customer-platform"
    shell: "BASH"
    trigger_condition: "ALWAYS"
  - action: "Execute: npm test"
    type: "BUILD"
    working_directory: "/buddy/sepa-customer-platform"
    docker_image_name: "library/node"
    docker_image_tag: "10"
    execute_commands:
    - "npm test"
    setup_commands:
    - "npm install -g gulp grunt-cli"
    mount_filesystem_path: "/buddy/sepa-customer-platform"
    shell: "BASH"
    trigger_condition: "ALWAYS"
